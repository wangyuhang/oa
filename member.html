<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/mui.indexedlist.css" rel="stylesheet" />
    <link href="css/member.css" rel="stylesheet" />
    <style>
		html,body,.mui-content{
			height: 100%;
			overflow: hidden;
		}
		.mui-bar {
			-webkit-box-shadow: none;
			box-shadow: none;
		}
	</style>
    
</head>
<body>
<div class="mui-content">
	<div id='list' class="mui-indexed-list">
		<div class="mui-indexed-list-search mui-input-row mui-search">
			<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="搜索">
		</div>
		<div class="mui-indexed-list-alert"></div>
		<div class="mui-indexed-list-inner">
			<div class="mui-indexed-list-empty-alert">没有数据</div>
			<ul id="memberList" class="mui-table-view">				
			</ul>
		</div>
	</div>
</div>
</body>
</html>
<script src="js/zepto.min.js"></script>
<script src="js/mui.min.js"></script>
<script src="js/mui.indexedlist.js"></script>
<script type="text/javascript" charset="utf-8">
	mui.init();
	
	function getMemberList() {
		mui.ajax('http://192.168.200.215/directory/frontend/web/index.php?r=site/get-directory ',{
			dataType:'json',
			type:'get',
			timeout:10000,
			success:function(result){
				if(result.succ) {
					var departmentHtml = '';
					mui.each(result.data, function() {
						var memberHtml = '';
						mui.each(this.member, function() {
							memberHtml += '<li first="'+this.first+'" class="mui-table-view-cell mui-indexed-list-item memeberItem" rel="'+this.id+'">'+
															'<div class="mui-slider-right mui-disabled">'+
																'<a class="addTag mui-btn mui-btn-green" rel="'+this.id+'">贴标签</a>'+
															'</div>'+
															'<div class="mui-slider-handle">'+this.user+'</div>'+
														'</li>'
						})
						departmentHtml += ('<li class="mui-table-view-divider mui-indexed-list-group">'+this.name+'</li>'+memberHtml);
					})
					$('#memberList').html(departmentHtml);	
				}else {
					mui.toast('获取数据失败');
				}
				waiting.close();
			},
			error:function(xhr,type,errorThrown){
				mui.toast('请检查网络');
				waiting.close() ;
			}
		});
	}
	
	
	mui('#memberList').on('tap', '.memeberItem', function() {
		var mid = this.getAttribute('rel');
  		var webview = mui.openWindow({
		    url: 'member_detail.html',
		    id: 'member_detail.html',
		    styles:{
		      top: '0px',//新页面顶部位置
		      bottom: '0px'
		    },
		    extras:{
		    		mid: mid
		    },
		    waiting:{
		      autoShow:true,//自动显示等待框，默认为true
		      title:'正在加载...'//等待对话框上显示的提示内容
		    }				  
		})
  	})
	
	mui(document).on('tap', '.addTag', function(event) {
  		event.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
  		var target = this;
		var btnArray = ['确定', '取消'];
		mui.prompt('from 黄培健 to 王宇航', '', '', btnArray, function(e) {
			if (e.index == 0) {
				mui.toast('添加成功');
			} else {
			}
			setTimeout(function() {
				mui.swipeoutClose(target);
			}, 1);
		})
  	})
	
	mui.ready(function() {
		var list = document.getElementById('list');
		//calc hieght
		list.style.height = (document.body.offsetHeight) + 'px';
		//create
		window.indexedList = new mui.IndexedList(list);
	});
	
	var waiting = null;
  	mui.plusReady(function(){
  		//waiting = plus.nativeUI.showWaiting('请等待...');
  		getMemberList();
  	})
</script>